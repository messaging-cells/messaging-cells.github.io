\hypertarget{mods__test_8cpp}{}\section{/home/jose/devel/messaging-\/cells/src/tests/modules/mods\+\_\+test.cpp File Reference}
\label{mods__test_8cpp}\index{/home/jose/devel/messaging-\/cells/src/tests/modules/mods\+\_\+test.\+cpp@{/home/jose/devel/messaging-\/cells/src/tests/modules/mods\+\_\+test.\+cpp}}


Main file for the modules example.  


{\ttfamily \#include \char`\"{}cell.\+hh\char`\"{}}\\*
{\ttfamily \#include \char`\"{}pru\+\_\+1.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}pru\+\_\+2.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}pru\+\_\+3.\+h\char`\"{}}\\*
Include dependency graph for mods\+\_\+test.\+cpp\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d3/db7/mods__test_8cpp__incl}
\end{center}
\end{figure}


\subsection{Detailed Description}
Main file for the modules example. 


\begin{DoxyCodeInclude}

\textcolor{comment}{//----------------------------------------------------------------------------}
\textcolor{comment}{}\textcolor{preprocessor}{#include "\hyperlink{cell_8hh}{cell.hh}"}
\textcolor{preprocessor}{#include "pru\_1.h"}
\textcolor{preprocessor}{#include "pru\_2.h"}
\textcolor{preprocessor}{#include "pru\_3.h"}

mc\_c\_decl \textcolor{keywordtype}{int} main();

\textcolor{keywordtype}{char}* m1\_nam mc\_external\_data\_ram = \textcolor{keyword}{const\_cast<}\textcolor{keywordtype}{char}*\textcolor{keyword}{>}(\textcolor{stringliteral}{"module1"});
\textcolor{keywordtype}{char}* m2\_nam mc\_external\_data\_ram = \textcolor{keyword}{const\_cast<}\textcolor{keywordtype}{char}*\textcolor{keyword}{>}(\textcolor{stringliteral}{"module2"});
\textcolor{keywordtype}{char}* m3\_nam mc\_external\_data\_ram = \textcolor{keyword}{const\_cast<}\textcolor{keywordtype}{char}*\textcolor{keyword}{>}(\textcolor{stringliteral}{"module3"});

\textcolor{preprocessor}{#define TOT\_MODS 3}

\textcolor{preprocessor}{#define MOD1\_IDX 1}
\textcolor{preprocessor}{#define MOD2\_IDX 2}
\textcolor{preprocessor}{#define MOD3\_IDX 0}

\textcolor{keywordtype}{char}* all\_mod\_nams[TOT\_MODS] mc\_external\_data\_ram;
mc\_addr\_t* all\_mod\_addr;

\textcolor{keywordtype}{void}
init\_module\_nams() mc\_external\_code\_ram;

\textcolor{keywordtype}{void}
init\_module\_nams()\{
    all\_mod\_nams[MOD1\_IDX] = m1\_nam;
    all\_mod\_nams[MOD2\_IDX] = m2\_nam;
    all\_mod\_nams[MOD3\_IDX] = m3\_nam;
\}


\textcolor{keywordtype}{void}
print\_module\_nams() mc\_external\_code\_ram;

\textcolor{keywordtype}{void}
print\_module\_nams()\{
    uint32\_t to\_m = mck\_get\_tot\_modules();
    uint32\_t aa = 0;
    \hyperlink{log_8h_addbe1979a58d9f84d5a009c5543818c2}{mck\_sprt2}(\textcolor{stringliteral}{"ALL\_MODULE\_NAMES=\(\backslash\)n"});
    \textcolor{keywordflow}{for}(aa = 0; aa < to\_m; aa++)\{
        \textcolor{keywordtype}{char}* nam0 = mck\_get\_module\_name(aa);
        \hyperlink{log_8h_addbe1979a58d9f84d5a009c5543818c2}{mck\_sprt2}(nam0);
        \hyperlink{log_8h_addbe1979a58d9f84d5a009c5543818c2}{mck\_sprt2}(\textcolor{stringliteral}{"\(\backslash\)n"});
    \}
\}

\textcolor{keywordtype}{void}
print\_module\_addrs() mc\_external\_code\_ram;

\textcolor{keywordtype}{void}
print\_module\_addrs()\{
    uint32\_t to\_m = mck\_get\_tot\_modules();
    uint32\_t aa = 0;
    \hyperlink{log_8h_addbe1979a58d9f84d5a009c5543818c2}{mck\_sprt2}(\textcolor{stringliteral}{"ALL\_MODULE\_ADDRS=\(\backslash\)n"});
    \textcolor{keywordflow}{for}(aa = 0; aa < to\_m; aa++)\{
        \textcolor{keywordtype}{char}* nam0 = all\_mod\_nams[aa];
        \hyperlink{log_8h_addbe1979a58d9f84d5a009c5543818c2}{mck\_sprt2}(nam0);
        \hyperlink{log_8h_addbe1979a58d9f84d5a009c5543818c2}{mck\_sprt2}(\textcolor{stringliteral}{" addr\_\_\_\_"});
        \hyperlink{log_8h_ad30d3b396a981772ee5d44dc332c2886}{mck\_xprt}(all\_mod\_addr[aa]);
        \hyperlink{log_8h_addbe1979a58d9f84d5a009c5543818c2}{mck\_sprt2}(\textcolor{stringliteral}{"\_\_\_\_\(\backslash\)n"});
    \}
\}

\textcolor{keywordtype}{void}
link\_all\_modules\_aux\_fn() mc\_external\_code\_ram;

\textcolor{keywordtype}{void}
link\_all\_modules\_aux\_fn()\{
    m1\_main();
    m2\_main();
    m3\_main();
\}

\textcolor{keywordtype}{int} main() \{
    mck\_glb\_init();
    \hyperlink{log_8h_a8ec0c02a2d94dec909d9cdc8340f733f}{mck\_slog2}(\textcolor{stringliteral}{"Modules main \(\backslash\)n"});

    init\_module\_nams();
    uint32\_t tot\_m = mck\_get\_tot\_modules();
    all\_mod\_addr = mc\_malloc32(mc\_addr\_t, tot\_m);
    mck\_fill\_module\_external\_addresses(all\_mod\_nams, all\_mod\_addr);

    \textcolor{keywordflow}{if}(MC\_CORE\_INFO->the\_core\_nn == 0)\{ 
        \textcolor{comment}{//print\_module\_nams();}
        \textcolor{comment}{//print\_module\_addrs();}
        \textcolor{keywordtype}{bool} ok = mck\_load\_module(all\_mod\_addr[MOD2\_IDX]);
        \textcolor{keywordflow}{if}(ok)\{
            m2\_main();
        \}
    \}
    \textcolor{keywordflow}{if}(MC\_CORE\_INFO->the\_core\_nn == 1)\{ 
        \textcolor{comment}{//print\_module\_nams();}
        \textcolor{comment}{//print\_module\_addrs();}
        \textcolor{keywordtype}{bool} ok = mck\_load\_module(all\_mod\_addr[MOD1\_IDX]);
        \textcolor{keywordflow}{if}(ok)\{
            m1\_main();
        \}
    \}
    \textcolor{keywordflow}{if}(MC\_CORE\_INFO->the\_core\_nn == 3)\{ 
        \textcolor{comment}{//print\_module\_nams();}
        \textcolor{comment}{//print\_module\_addrs();}
        \textcolor{keywordtype}{bool} ok = mck\_load\_module(all\_mod\_addr[MOD3\_IDX]);
        \textcolor{keywordflow}{if}(ok)\{
            m3\_main();
        \}
    \}
    \hyperlink{log_8h_a8ec0c02a2d94dec909d9cdc8340f733f}{mck\_slog2}(\textcolor{stringliteral}{"\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\(\backslash\)n"});

    mck\_glb\_finish();
    \textcolor{keywordflow}{return} 0;
\}

\end{DoxyCodeInclude}
 