<!-- HTML header for doxygen 1.8.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Library-Documentation: /home/jose/devel/messaging-cells/src/tests/eating_philo/philo.cpp File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="../../../../index.html"><img alt="Logo" src="../../mc-logo.png"/></a></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname"><a href="../../../../index.html">Library-Documentation</a>
   </div>
   <div id="projectbrief">Selected Documentation for Messaging-Cells Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_d23e7dd0db2c3d54d564f81d81af5dc0.html">messaging-cells</a></li><li class="navelem"><a class="el" href="../../dir_3cb4b0be928bfc2e75211e817519202d.html">src</a></li><li class="navelem"><a class="el" href="../../dir_56a6428f15bbc5405e28294093c6a82c.html">tests</a></li><li class="navelem"><a class="el" href="../../dir_dac1725b430af28f3a014f7cc910c69a.html">eating_philo</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#define-members">Macros</a>  </div>
  <div class="headertitle">
<div class="title">philo.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Implementation of the classical concurrency example of the <a href="https://en.wikipedia.org/wiki/Dining_philosophers_problem">eating philosophers</a>.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="../../da/d7a/cell_8hh.html">cell.hh</a>&quot;</code><br />
</div><div class="textblock"><div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="../../closed.png" alt="+"/> Include dependency graph for philo.cpp:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../dd/dbe/philo_8cpp__incl.png" border="0" usemap="#_2home_2jose_2devel_2messaging-cells_2src_2tests_2eating__philo_2philo_8cpp" alt=""/></div>
<map name="_2home_2jose_2devel_2messaging-cells_2src_2tests_2eating__philo_2philo_8cpp" id="_2home_2jose_2devel_2messaging-cells_2src_2tests_2eating__philo_2philo_8cpp">
<area shape="rect" id="node2" href="../../da/d7a/cell_8hh.html" title="The one and only include file necessarry to use the Messagging Cells library. " alt="" coords="69,109,129,136"/>
<area shape="rect" id="node4" href="../../d2/d49/global_8h.html" title="Global functions. It is included in cell.hh. " alt="" coords="107,184,174,211"/>
<area shape="rect" id="node5" href="../../da/db4/shared_8h.html" title="C shared structures (by host and cores). It is included in global.h and cell.hh. " alt="" coords="177,333,249,360"/>
<area shape="rect" id="node12" href="../../db/db8/loader_8h.html" title="Macros to access the linker script values. " alt="" coords="107,259,175,285"/>
<area shape="rect" id="node13" href="../../d1/d1b/trace_8h.html" title="Trace functions. " alt="" coords="9,333,72,360"/>
<area shape="rect" id="node9" href="../../d7/d7f/log_8h.html" title="Defines log functions and macros. " alt="" coords="157,408,207,435"/>
<area shape="rect" id="node10" href="../../d3/de3/shared__eph_8h.html" title="Addressing functions for the epiphany architecture.. " alt="" coords="372,408,472,435"/>
<area shape="rect" id="node11" href="../../da/dd1/shared__eph3_8h.html" title="Addressing functions of the epiphany 3 architecture. " alt="" coords="369,483,475,509"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/d2d/classchopstick.html">chopstick</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Class for chopsticks.  <a href="../../d0/d2d/classchopstick.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/dc6/classphilosopher.html">philosopher</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Class for philosophers.  <a href="../../df/dc6/classphilosopher.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a80458da12ef75d2c9eb5f185b2e09d73"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a80458da12ef75d2c9eb5f185b2e09d73"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d85/philo_8cpp.html#a80458da12ef75d2c9eb5f185b2e09d73">glb_stick</a>&#160;&#160;&#160;(&amp;(glb_philo_core-&gt;stick))</td></tr>
<tr class="memdesc:a80458da12ef75d2c9eb5f185b2e09d73"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the local <a class="el" href="../../d0/d2d/classchopstick.html">chopstick</a>. <br /></td></tr>
<tr class="separator:a80458da12ef75d2c9eb5f185b2e09d73"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adcc662701c5f055b26a048484d17e2c6"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="adcc662701c5f055b26a048484d17e2c6"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d85/philo_8cpp.html#adcc662701c5f055b26a048484d17e2c6">glb_philo</a>&#160;&#160;&#160;(&amp;(glb_philo_core-&gt;philo))</td></tr>
<tr class="memdesc:adcc662701c5f055b26a048484d17e2c6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the local <a class="el" href="../../df/dc6/classphilosopher.html">philosopher</a>. <br /></td></tr>
<tr class="separator:adcc662701c5f055b26a048484d17e2c6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a35a8b253ce444013c865600fd0694afa"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a35a8b253ce444013c865600fd0694afa"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d85/philo_8cpp.html#a35a8b253ce444013c865600fd0694afa">get_stick</a>(id)&#160;&#160;&#160;((<a class="el" href="../../d0/d2d/classchopstick.html">chopstick</a>*)<a class="el" href="../../da/dd1/shared__eph3_8h.html#a6894e5bde816e6d104c56ec5a8c8288a">mc_addr_set_id</a>(id, <a class="el" href="../../d7/d85/philo_8cpp.html#a80458da12ef75d2c9eb5f185b2e09d73">glb_stick</a>))</td></tr>
<tr class="memdesc:a35a8b253ce444013c865600fd0694afa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the <a class="el" href="../../d0/d2d/classchopstick.html">chopstick</a> in core with 'id'. <br /></td></tr>
<tr class="separator:a35a8b253ce444013c865600fd0694afa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0ccca4eb20a8d8be83aeb5822cc2d30c"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a0ccca4eb20a8d8be83aeb5822cc2d30c"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d85/philo_8cpp.html#a0ccca4eb20a8d8be83aeb5822cc2d30c">get_philo</a>(id)&#160;&#160;&#160;((<a class="el" href="../../df/dc6/classphilosopher.html">philosopher</a>*)<a class="el" href="../../da/dd1/shared__eph3_8h.html#a6894e5bde816e6d104c56ec5a8c8288a">mc_addr_set_id</a>(id, <a class="el" href="../../d7/d85/philo_8cpp.html#adcc662701c5f055b26a048484d17e2c6">glb_philo</a>))</td></tr>
<tr class="memdesc:a0ccca4eb20a8d8be83aeb5822cc2d30c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the <a class="el" href="../../df/dc6/classphilosopher.html">philosopher</a> in core with 'id'. <br /></td></tr>
<tr class="separator:a0ccca4eb20a8d8be83aeb5822cc2d30c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Implementation of the classical concurrency example of the <a href="https://en.wikipedia.org/wiki/Dining_philosophers_problem">eating philosophers</a>. </p>
<div class="fragment"><div class="line"><span class="comment">//----------------------------------------------------------------------------</span></div><div class="line"><span class="comment"></span><span class="preprocessor">#include &quot;<a class="code" href="../../da/d7a/cell_8hh.html">cell.hh</a>&quot;</span></div><div class="line"></div><div class="line"><span class="comment">//define PHILO_EPH_DBG</span></div><div class="line"></div><div class="line"><span class="preprocessor">#ifdef MC_IS_EMU_CODE</span></div><div class="line"><span class="preprocessor">#define PHILO_WITH_DBG</span></div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line"><span class="preprocessor">#ifdef PHILO_WITH_DBG</span></div><div class="line"><span class="preprocessor">    #include &quot;stdio.h&quot;</span></div><div class="line"></div><div class="line">    <span class="keywordtype">bool</span> dbg_all_idle_prt[16] mc_external_code_ram = {</div><div class="line">        <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, </div><div class="line">        <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, </div><div class="line">        <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, </div><div class="line">        <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span></div><div class="line">    };</div><div class="line">    <span class="keywordtype">bool</span> dbg_all_full[16] mc_external_code_ram = {</div><div class="line">        <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, </div><div class="line">        <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, </div><div class="line">        <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, </div><div class="line">        <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span></div><div class="line">    };</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> prt_idle() mc_external_code_ram;</div><div class="line">    <span class="keywordtype">void</span> prt_full() mc_external_code_ram;</div><div class="line">    <span class="keywordtype">void</span> prt_all_philo() mc_external_code_ram;</div><div class="line"></div><div class="line">    <span class="keywordtype">bool</span> prt_recv_msgs mc_external_code_ram = false;</div><div class="line">    <span class="keywordtype">bool</span> prt_send_msgs mc_external_code_ram = false;</div><div class="line"></div><div class="line">    <span class="preprocessor">#define PH_DBG_COD(prm) prm</span></div><div class="line"><span class="preprocessor">#else</span></div><div class="line"><span class="preprocessor">    #define PH_DBG_COD(prm) </span></div><div class="line"><span class="preprocessor">#endif // END_OF_PHILO_WITH_DBG</span></div><div class="line"></div><div class="line"><span class="keyword">class </span><a class="code" href="../../d0/d2d/classchopstick.html">chopstick</a>;</div><div class="line"><span class="keyword">class </span><a class="code" href="../../df/dc6/classphilosopher.html">philosopher</a>;</div><div class="line"></div><div class="line"><span class="preprocessor">#define MAX_BITES 10</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define PH_DBG EMU_PRT</span></div><div class="line"></div><div class="line"><span class="keyword">enum</span> philo_tok_t : uint8_t {</div><div class="line">    tok_invalid,</div><div class="line">    tok_eat,</div><div class="line">    tok_take,</div><div class="line">    tok_taken,</div><div class="line">    tok_not_taken,</div><div class="line">    tok_drop,</div><div class="line">    tok_droped,</div><div class="line">    tok_not_droped, </div><div class="line">    tok_yes_full</div><div class="line">};</div><div class="line"></div><div class="line"><span class="comment">//ifdef PHILO_WITH_DBG</span></div><div class="line">    <span class="keywordtype">char</span>*</div><div class="line">    tok_to_str(philo_tok_t tok) mc_external_code_ram;</div><div class="line"></div><div class="line">    <span class="keywordtype">char</span>*</div><div class="line">    tok_to_str(philo_tok_t tok){</div><div class="line">        <span class="keywordflow">switch</span>(tok){</div><div class="line">        <span class="keywordflow">case</span> tok_invalid:</div><div class="line">            <span class="keywordflow">return</span> <span class="keyword">const_cast&lt;</span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(<span class="stringliteral">&quot;invalid&quot;</span>);</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> tok_eat:</div><div class="line">            <span class="keywordflow">return</span> <span class="keyword">const_cast&lt;</span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(<span class="stringliteral">&quot;eat&quot;</span>);</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> tok_take:</div><div class="line">            <span class="keywordflow">return</span> <span class="keyword">const_cast&lt;</span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(<span class="stringliteral">&quot;take&quot;</span>);</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> tok_taken:</div><div class="line">            <span class="keywordflow">return</span> <span class="keyword">const_cast&lt;</span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(<span class="stringliteral">&quot;taken&quot;</span>);</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> tok_not_taken:</div><div class="line">            <span class="keywordflow">return</span> <span class="keyword">const_cast&lt;</span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(<span class="stringliteral">&quot;not_taken&quot;</span>);</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> tok_drop:</div><div class="line">            <span class="keywordflow">return</span> <span class="keyword">const_cast&lt;</span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(<span class="stringliteral">&quot;drop&quot;</span>);</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> tok_droped:</div><div class="line">            <span class="keywordflow">return</span> <span class="keyword">const_cast&lt;</span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(<span class="stringliteral">&quot;droped&quot;</span>);</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> tok_not_droped:</div><div class="line">            <span class="keywordflow">return</span> <span class="keyword">const_cast&lt;</span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(<span class="stringliteral">&quot;not_droped&quot;</span>);</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> tok_yes_full:</div><div class="line">            <span class="keywordflow">return</span> <span class="keyword">const_cast&lt;</span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(<span class="stringliteral">&quot;yes_fll&quot;</span>);</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">default</span>:</div><div class="line">            <a class="code" href="../../d2/d49/global_8h.html#a6a6d1065bccc17077e1a6a0aeaa5f6dd">mck_abort</a>(1, const_cast&lt;char*&gt;(<span class="stringliteral">&quot;BAD_PHILO_TOK&quot;</span>));</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">return</span> <span class="keyword">const_cast&lt;</span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(<span class="stringliteral">&quot;NO_TOK&quot;</span>);</div><div class="line">    }</div><div class="line"><span class="comment">//endif // END_OF_PHILO_WITH_DBG</span></div><div class="line"></div><div class="line"><span class="keyword">class </span><a class="code" href="../../d0/d2d/classchopstick.html">chopstick</a> : <span class="keyword">public</span> <a class="code" href="../../d2/dbe/classcell.html">cell</a> {</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <a class="code" href="../../da/d7a/cell_8hh.html#ab43adc7961f0b5b06463b122ae598993">MCK_DECLARE_MEM_METHODS</a>(<a class="code" href="../../d0/d2d/classchopstick.html">chopstick</a>)</div><div class="line"></div><div class="line">    <a class="code" href="../../d2/dbe/classcell.html">cell</a>* owner;</div><div class="line"></div><div class="line">    <a class="code" href="../../d2/dbe/classcell.html">cell</a>* last_src;</div><div class="line">    philo_tok_t last_sent;</div><div class="line">    philo_tok_t last_recv;</div><div class="line"></div><div class="line">    <a class="code" href="../../d0/d2d/classchopstick.html">chopstick</a>(){</div><div class="line">        init_chopstick();</div><div class="line">    }</div><div class="line"></div><div class="line">    ~<a class="code" href="../../d0/d2d/classchopstick.html">chopstick</a>(){}</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> init_chopstick(){</div><div class="line">        <a class="code" href="../../d2/dbe/classcell.html#a234bbd022db21480b428b2f63662fe95">handler_idx</a> = 1;</div><div class="line">        owner = mc_null;</div><div class="line"></div><div class="line">        last_src = mc_null;</div><div class="line">        last_sent = tok_invalid;</div><div class="line">        last_recv = tok_invalid;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> handler(<a class="code" href="../../d4/d9f/classmissive.html">missive</a>* msv);</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">class </span><a class="code" href="../../df/dc6/classphilosopher.html">philosopher</a> : <span class="keyword">public</span> <a class="code" href="../../d2/dbe/classcell.html">cell</a> {</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <a class="code" href="../../da/d7a/cell_8hh.html#ab43adc7961f0b5b06463b122ae598993">MCK_DECLARE_MEM_METHODS</a>(<a class="code" href="../../df/dc6/classphilosopher.html">philosopher</a>)</div><div class="line"></div><div class="line">    <a class="code" href="../../d0/d2d/classchopstick.html">chopstick</a>* left;</div><div class="line">    <a class="code" href="../../d0/d2d/classchopstick.html">chopstick</a>* right;</div><div class="line"></div><div class="line">    <span class="keywordtype">int</span> num_bites;</div><div class="line">    <span class="keywordtype">bool</span> lft_ph_full;</div><div class="line">    <span class="keywordtype">bool</span> rgt_ph_full;</div><div class="line"></div><div class="line">    mc_core_id_t    lft_stk_id;</div><div class="line">    mc_core_id_t    rgt_stk_id;</div><div class="line">    <a class="code" href="../../d0/d2d/classchopstick.html">chopstick</a>*      lft_stick;</div><div class="line">    <a class="code" href="../../d0/d2d/classchopstick.html">chopstick</a>*      rgt_stick;</div><div class="line">    mc_core_id_t    lft_phi_id;</div><div class="line">    mc_core_id_t    rgt_phi_id;</div><div class="line">    <a class="code" href="../../df/dc6/classphilosopher.html">philosopher</a>*    lft_philo;</div><div class="line">    <a class="code" href="../../df/dc6/classphilosopher.html">philosopher</a>*    rgt_philo;</div><div class="line"></div><div class="line">    philo_tok_t last_sent;</div><div class="line">    philo_tok_t last_sent_lft;</div><div class="line">    philo_tok_t last_sent_rgt;</div><div class="line">    philo_tok_t last_recv;</div><div class="line">    philo_tok_t last_recv_lft;</div><div class="line">    philo_tok_t last_recv_rgt;</div><div class="line"></div><div class="line">    <a class="code" href="../../df/dc6/classphilosopher.html">philosopher</a>(){</div><div class="line">        init_philosopher();</div><div class="line">    }</div><div class="line"></div><div class="line">    ~<a class="code" href="../../df/dc6/classphilosopher.html">philosopher</a>(){}</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> init_philosopher(){</div><div class="line">        <a class="code" href="../../d2/dbe/classcell.html#a234bbd022db21480b428b2f63662fe95">handler_idx</a> = 2;</div><div class="line"></div><div class="line">        left = mc_null;</div><div class="line">        right = mc_null;</div><div class="line"></div><div class="line">        num_bites = 0;</div><div class="line">        lft_ph_full = <span class="keyword">false</span>;</div><div class="line">        rgt_ph_full = <span class="keyword">false</span>;</div><div class="line"></div><div class="line">        lft_stk_id = ~0;</div><div class="line">        rgt_stk_id = ~0;</div><div class="line">        lft_stick = mc_null;</div><div class="line">        rgt_stick = mc_null;</div><div class="line">        lft_phi_id = ~0;</div><div class="line">        rgt_phi_id = ~0;</div><div class="line">        lft_philo = mc_null;</div><div class="line">        rgt_philo = mc_null;</div><div class="line"></div><div class="line">        last_sent = tok_invalid;</div><div class="line">        last_sent_lft = tok_invalid;</div><div class="line">        last_sent_rgt = tok_invalid;</div><div class="line">        last_recv = tok_invalid;</div><div class="line">        last_recv_lft = tok_invalid;</div><div class="line">        last_recv_rgt = tok_invalid;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> handler(<a class="code" href="../../d4/d9f/classmissive.html">missive</a>* msv);</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> send(<a class="code" href="../../d2/dbe/classcell.html">cell</a>* dst, philo_tok_t tok);</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> send_full();</div><div class="line"></div><div class="line">    <span class="keywordtype">bool</span> can_exit(){</div><div class="line">        <span class="keywordflow">return</span> ((left == mc_null) &amp;&amp; (right == mc_null) &amp;&amp; (num_bites == MAX_BITES) &amp;&amp; rgt_ph_full &amp;&amp; lft_ph_full);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> call_exit();</div><div class="line">};</div><div class="line"></div><div class="line"><span class="comment">// For global data. DO NOT USE GLOBAL VARIABLES IF YOU WANT THE EMULATOR (cores as threads) TO WORK.</span></div><div class="line"><span class="keyword">class </span>philo_core {</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <a class="code" href="../../da/d7a/cell_8hh.html#ab43adc7961f0b5b06463b122ae598993">MCK_DECLARE_MEM_METHODS</a>(philo_core)</div><div class="line"></div><div class="line">    philo_core(){       <span class="comment">// NEED THIS SO THAT no memset func call</span></div><div class="line">        init_philo_core();</div><div class="line">    }       </div><div class="line">    ~philo_core(){}     <span class="comment">// NEED THIS SO THAT no memset func call</span></div><div class="line"></div><div class="line">    <a class="code" href="../../d0/d2d/classchopstick.html">chopstick</a> stick;</div><div class="line">    <a class="code" href="../../df/dc6/classphilosopher.html">philosopher</a> philo;</div><div class="line">    grip ava_chopstick;</div><div class="line">    grip ava_philosopher;</div><div class="line"></div><div class="line">    mc_size_t from_host_work_sz;</div><div class="line">    mc_size_t to_host_work_sz;</div><div class="line">    mc_size_t in_work_sz;</div><div class="line">    mc_size_t local_work_sz;</div><div class="line">    mc_size_t out_work_sz;</div><div class="line">    mc_size_t sent_work_sz;</div><div class="line">    mc_size_t cls_available_cell_sz;</div><div class="line">    mc_size_t cls_available_missive_sz;</div><div class="line">    mc_size_t cls_available_agent_ref_sz;</div><div class="line">    mc_size_t cls_available_agent_grp_sz;</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> init_philo_core(){</div><div class="line">        from_host_work_sz = 0;</div><div class="line">        to_host_work_sz = 0;</div><div class="line">        in_work_sz = 0;</div><div class="line">        local_work_sz = 0;</div><div class="line">        out_work_sz = 0;</div><div class="line">        sent_work_sz = 0;</div><div class="line">        cls_available_cell_sz = 0;</div><div class="line">        cls_available_missive_sz = 0;</div><div class="line">        cls_available_agent_ref_sz = 0;</div><div class="line">        cls_available_agent_grp_sz = 0;</div><div class="line">    }</div><div class="line">};</div><div class="line"></div><div class="line"><a class="code" href="../../da/d7a/cell_8hh.html#aad0dec1d661f1fdb5a2ccb767d712c75">MCK_DEFINE_ACQUIRE_ALLOC</a>(philo_core, 32);   <span class="comment">// defines philo_core::acquire_alloc</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define glb_philo_core ((philo_core*)(mck_get_kernel()-&gt;user_data))</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define glb_stick (&amp;(glb_philo_core-&gt;stick))</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define glb_philo (&amp;(glb_philo_core-&gt;philo))</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define glb_ava_sticks (glb_philo_core-&gt;ava_chopstick)</span></div><div class="line"><span class="preprocessor">#define glb_ava_philos (glb_philo_core-&gt;ava_philosopher)</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define left_chp_nn(nn) (nn)</span></div><div class="line"><span class="preprocessor">#define right_chp_nn(nn) ((nn == 15)?(0):(nn + 1))</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define left_phl_nn(nn) ((nn == 0)?(15):(nn - 1))</span></div><div class="line"><span class="preprocessor">#define right_phl_nn(nn) ((nn == 15)?(0):(nn + 1))</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define get_stick(id) ((chopstick*)mc_addr_set_id(id, glb_stick))</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define get_philo(id) ((philosopher*)mc_addr_set_id(id, glb_philo))</span></div><div class="line"></div><div class="line"><a class="code" href="../../da/d7a/cell_8hh.html#a9095d9f262f63984c60799e4a3b135c5">MCK_DEFINE_MEM_METHODS</a>(<a class="code" href="../../d0/d2d/classchopstick.html">chopstick</a>, 32, glb_ava_sticks)</div><div class="line"><a class="code" href="../../da/d7a/cell_8hh.html#a9095d9f262f63984c60799e4a3b135c5">MCK_DEFINE_MEM_METHODS</a>(<a class="code" href="../../df/dc6/classphilosopher.html">philosopher</a>, 32, glb_ava_philos)</div><div class="line"></div><div class="line"></div><div class="line"><span class="preprocessor">#ifdef PHILO_WITH_DBG</span></div><div class="line">    philo_core* </div><div class="line">    dbg_all_philo[16] mc_external_code_ram = {</div><div class="line">        mc_null, mc_null, mc_null, mc_null, </div><div class="line">        mc_null, mc_null, mc_null, mc_null, </div><div class="line">        mc_null, mc_null, mc_null, mc_null, </div><div class="line">        mc_null, mc_null, mc_null, mc_null</div><div class="line">    };</div><div class="line"><span class="preprocessor">#endif // END_OF_PHILO_WITH_DBG</span></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> </div><div class="line">philosopher_handler(<a class="code" href="../../d4/d9f/classmissive.html">missive</a>* msv){</div><div class="line">    MCK_CALL_HANDLER(philosopher, handler, msv);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> </div><div class="line">chopstick_handler(<a class="code" href="../../d4/d9f/classmissive.html">missive</a>* msv){</div><div class="line">    MCK_CALL_HANDLER(<a class="code" href="../../d0/d2d/classchopstick.html">chopstick</a>, handler, msv);</div><div class="line">}</div><div class="line"></div><div class="line"><a class="code" href="../../da/d7a/cell_8hh.html#ad48af79638ac0f2892ed41375e3aed54">missive_handler_t</a> <a class="code" href="../../df/de0/send__msg_8cpp.html#ade3c9ba0c2c2bff40e568b58bf28efa5">the_handlers</a>[] = {</div><div class="line">    mc_null,</div><div class="line">    chopstick_handler,</div><div class="line">    philosopher_handler</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keywordtype">void</span></div><div class="line">chopstick::handler(<a class="code" href="../../d4/d9f/classmissive.html">missive</a>* msv){</div><div class="line">    <a class="code" href="../../d2/dbe/classcell.html">cell</a>* msv_src = msv-&gt;src;</div><div class="line">    philo_tok_t tok = (philo_tok_t)msv-&gt;tok;</div><div class="line"></div><div class="line">    last_src = msv_src;</div><div class="line">    last_recv = tok;</div><div class="line"></div><div class="line">    mc_core_nn_t nn = <a class="code" href="../../da/d7a/cell_8hh.html#af1eb47800585646e0caf6cb269111731">mck_get_kernel</a>()-&gt;get_core_nn();</div><div class="line">    PH_DBG_COD(</div><div class="line">        <span class="keywordflow">if</span>(prt_recv_msgs){</div><div class="line">            PH_DBG(<span class="stringliteral">&quot;CHOP %d RECV %s \n&quot;</span>, nn, tok_to_str(tok));</div><div class="line">        }</div><div class="line">    )</div><div class="line">    <span class="keywordflow">if</span>((nn == 0) || (nn &gt;= 14)){</div><div class="line"><span class="preprocessor">        #ifdef PHILO_EPH_DBG</span></div><div class="line">            mc_core_id_t src_id = <a class="code" href="../../da/dd1/shared__eph3_8h.html#a7318efe779877691f45272404b4f14b8">mc_addr_get_id</a>(msv_src);</div><div class="line">            <a class="code" href="../../d7/d7f/log_8h.html#a8ec0c02a2d94dec909d9cdc8340f733f">mck_slog2</a>(<span class="stringliteral">&quot;CHOP_RECV____&quot;</span>);</div><div class="line">            <a class="code" href="../../d7/d7f/log_8h.html#a8ec0c02a2d94dec909d9cdc8340f733f">mck_slog2</a>(tok_to_str(tok));</div><div class="line">            <a class="code" href="../../d7/d7f/log_8h.html#a8ec0c02a2d94dec909d9cdc8340f733f">mck_slog2</a>(<span class="stringliteral">&quot;___&quot;</span>);</div><div class="line">            <a class="code" href="../../d7/d7f/log_8h.html#aa4f0190d914cecf5db43914dc69f7129">mck_xlog</a>((mc_addr_t)msv_src);</div><div class="line">            <a class="code" href="../../d7/d7f/log_8h.html#a8ec0c02a2d94dec909d9cdc8340f733f">mck_slog2</a>(<span class="stringliteral">&quot;___&quot;</span>);</div><div class="line">            <a class="code" href="../../d7/d7f/log_8h.html#a14e1de1564f270c82ff08d1b9ad41a66">mck_ilog</a>(mc_id_to_nn(src_id));</div><div class="line">            <a class="code" href="../../d7/d7f/log_8h.html#a8ec0c02a2d94dec909d9cdc8340f733f">mck_slog2</a>(<span class="stringliteral">&quot;___\n&quot;</span>);</div><div class="line"></div><div class="line">            <span class="keywordflow">if</span>(nn == 15){</div><div class="line">                <span class="comment">//kernel* ker = mck_get_kernel();</span></div><div class="line">                <span class="keywordtype">bool</span> ini0 = mck_is_id_inited(mc_nn_to_id(0));</div><div class="line">                <span class="comment">//long osz = ker-&gt;out_work.calc_size();</span></div><div class="line">                <span class="comment">//mck_ack_t loc_dst_ack_pt = (ker-&gt;pw0_routed_ack_arr)[0];</span></div><div class="line">                <a class="code" href="../../d7/d7f/log_8h.html#a8ec0c02a2d94dec909d9cdc8340f733f">mck_slog2</a>(<span class="stringliteral">&quot;ADDR_INI____&quot;</span>);</div><div class="line">                <a class="code" href="../../d7/d7f/log_8h.html#aa4f0190d914cecf5db43914dc69f7129">mck_xlog</a>((mc_addr_t)(&amp;(MC_CORE_INFO-&gt;inited_core)));</div><div class="line">                <a class="code" href="../../d7/d7f/log_8h.html#a8ec0c02a2d94dec909d9cdc8340f733f">mck_slog2</a>(<span class="stringliteral">&quot;___\n&quot;</span>);</div><div class="line"></div><div class="line">                <a class="code" href="../../d7/d7f/log_8h.html#a8ec0c02a2d94dec909d9cdc8340f733f">mck_slog2</a>(<span class="stringliteral">&quot;INI_0____&quot;</span>);</div><div class="line">                <a class="code" href="../../d7/d7f/log_8h.html#a14e1de1564f270c82ff08d1b9ad41a66">mck_ilog</a>(ini0);</div><div class="line">                <a class="code" href="../../d7/d7f/log_8h.html#a8ec0c02a2d94dec909d9cdc8340f733f">mck_slog2</a>(<span class="stringliteral">&quot;___\n&quot;</span>);</div><div class="line">            }</div><div class="line"><span class="preprocessor">        #endif</span></div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">switch</span>(tok){</div><div class="line">        <span class="keywordflow">case</span> tok_take:</div><div class="line">            EMU_CK(owner != msv_src);</div><div class="line">            <span class="keywordflow">if</span>(owner == mc_null){</div><div class="line">                owner = msv_src;</div><div class="line">                last_sent = tok_taken;</div><div class="line">                respond(msv, tok_taken);</div><div class="line">            } <span class="keywordflow">else</span> {</div><div class="line">                EMU_CK(owner != mc_null);</div><div class="line">                last_sent = tok_not_taken;</div><div class="line">                respond(msv, tok_not_taken);</div><div class="line">            }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> tok_drop:</div><div class="line">            EMU_CK(owner == msv_src);</div><div class="line">            owner = mc_null;</div><div class="line">            last_sent = tok_droped;</div><div class="line">            respond(msv, tok_droped);</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">default</span>:</div><div class="line">            <a class="code" href="../../d2/d49/global_8h.html#a6a6d1065bccc17077e1a6a0aeaa5f6dd">mck_abort</a>(1, const_cast&lt;char*&gt;(<span class="stringliteral">&quot;BAD_STICK_TOK&quot;</span>));</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line">    </div><div class="line">    <span class="comment">//mck_get_kernel()-&gt;set_idle_exit();</span></div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span></div><div class="line">philosopher::send(<a class="code" href="../../d2/dbe/classcell.html">cell</a>* dst, philo_tok_t tok){</div><div class="line">    PH_DBG_COD(</div><div class="line">        <span class="keywordflow">if</span>(prt_send_msgs){</div><div class="line">            PH_DBG(<span class="stringliteral">&quot;PHIL SEND %d \n&quot;</span>, tok);</div><div class="line">        }</div><div class="line">    )</div><div class="line"></div><div class="line">    last_sent = tok;</div><div class="line">    <span class="keywordflow">if</span>(dst == lft_stick){ last_sent_lft = tok; }</div><div class="line">    <span class="keywordflow">if</span>(dst == rgt_stick){ last_sent_rgt = tok; }</div><div class="line"></div><div class="line">    <a class="code" href="../../d4/d9f/classmissive.html">missive</a>* msv = <a class="code" href="../../d4/d9f/classmissive.html#a911a5d60180223ebff8d71966c483ee5">missive::acquire</a>();</div><div class="line">    msv-&gt;src = <span class="keyword">this</span>;</div><div class="line">    msv-&gt;dst = dst;</div><div class="line">    msv-&gt;tok = tok;</div><div class="line">    msv-&gt;<a class="code" href="../../d4/d9f/classmissive.html#a642a46a0f5cce3c99dc17b1c1acb5f6f">send</a>();</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span></div><div class="line">philosopher::handler(<a class="code" href="../../d4/d9f/classmissive.html">missive</a>* msv){</div><div class="line">    <a class="code" href="../../d2/dbe/classcell.html">cell</a>* msv_src = msv-&gt;src;</div><div class="line">    philo_tok_t tok = (philo_tok_t)msv-&gt;tok;</div><div class="line">    mc_core_nn_t nn = <a class="code" href="../../da/d7a/cell_8hh.html#af1eb47800585646e0caf6cb269111731">mck_get_kernel</a>()-&gt;get_core_nn();</div><div class="line">    MC_MARK_USED(nn);</div><div class="line"></div><div class="line">    PH_DBG_COD(</div><div class="line">        <span class="keywordflow">if</span>(prt_recv_msgs){</div><div class="line">            PH_DBG(<span class="stringliteral">&quot;PHIL %d RECV %s \n&quot;</span>, nn, tok_to_str(tok));</div><div class="line">        }</div><div class="line">    )</div><div class="line"></div><div class="line">    last_recv = tok;</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span>(msv_src == lft_stick){ last_recv_lft = tok; }</div><div class="line">    <span class="keywordflow">if</span>(msv_src == rgt_stick){ last_recv_rgt = tok; }</div><div class="line"></div><div class="line">    <span class="keywordflow">switch</span>(tok){</div><div class="line">        <span class="keywordflow">case</span> tok_eat:</div><div class="line">            EMU_CK(msv_src == <span class="keyword">this</span>);</div><div class="line">            EMU_CK(left == mc_null);</div><div class="line">            EMU_CK(right == mc_null);</div><div class="line">            EMU_CK(num_bites &lt; MAX_BITES);</div><div class="line">            send(lft_stick, tok_take);</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> tok_taken:</div><div class="line">            EMU_CK((msv_src == lft_stick) || (msv_src == rgt_stick));</div><div class="line">            <span class="keywordflow">if</span>(msv_src == lft_stick){</div><div class="line">                EMU_CK(left == mc_null);</div><div class="line">                EMU_CK(right == mc_null);</div><div class="line">                left = lft_stick;</div><div class="line">                send(rgt_stick, tok_take);</div><div class="line">    </div><div class="line"><span class="preprocessor">                #ifdef PHILO_EPH_DBG</span></div><div class="line">                    <span class="keywordflow">if</span>(nn == 15){</div><div class="line">                        <a class="code" href="../../d7/d7f/log_8h.html#a8ec0c02a2d94dec909d9cdc8340f733f">mck_slog2</a>(<span class="stringliteral">&quot;SENT_TAKE_RIGHT&quot;</span>);</div><div class="line">                    }</div><div class="line"><span class="preprocessor">                #endif</span></div><div class="line">            }</div><div class="line">            <span class="keywordflow">if</span>(msv_src == rgt_stick){</div><div class="line">                EMU_CK(left == lft_stick);</div><div class="line">                EMU_CK(right == mc_null);</div><div class="line">                right = rgt_stick;</div><div class="line"></div><div class="line">                EMU_CK(left != mc_null);</div><div class="line">                EMU_CK(right != mc_null);</div><div class="line">                EMU_CK(num_bites &lt; MAX_BITES);</div><div class="line">                num_bites++;</div><div class="line">                PH_DBG(<span class="stringliteral">&quot;#BITES %d \n&quot;</span>, num_bites);</div><div class="line">                EMU_LOG(<span class="stringliteral">&quot;#BITES %d \n&quot;</span>, num_bites);</div><div class="line"></div><div class="line"><span class="preprocessor">                #ifdef PHILO_EPH_DBG</span></div><div class="line">                    <a class="code" href="../../d7/d7f/log_8h.html#a8ec0c02a2d94dec909d9cdc8340f733f">mck_slog2</a>(<span class="stringliteral">&quot;#BITES____&quot;</span>);</div><div class="line">                    <a class="code" href="../../d7/d7f/log_8h.html#a14e1de1564f270c82ff08d1b9ad41a66">mck_ilog</a>(num_bites);</div><div class="line">                    <a class="code" href="../../d7/d7f/log_8h.html#a8ec0c02a2d94dec909d9cdc8340f733f">mck_slog2</a>(<span class="stringliteral">&quot;___\n&quot;</span>);</div><div class="line"><span class="preprocessor">                #endif</span></div><div class="line"></div><div class="line">                send(lft_stick, tok_drop);</div><div class="line">                send(rgt_stick, tok_drop);</div><div class="line">            }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> tok_not_taken:</div><div class="line">            EMU_CK((msv_src == lft_stick) || (msv_src == rgt_stick));</div><div class="line">            <span class="keywordflow">if</span>(msv_src == lft_stick){</div><div class="line">                EMU_CK(left == mc_null);</div><div class="line">                EMU_CK(right == mc_null);</div><div class="line">                send(<span class="keyword">this</span>, tok_eat);</div><div class="line">            }</div><div class="line">            <span class="keywordflow">if</span>(msv_src == rgt_stick){</div><div class="line">                EMU_CK(left == lft_stick);</div><div class="line">                EMU_CK(right == mc_null);</div><div class="line">                send(lft_stick, tok_drop);</div><div class="line">            }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> tok_droped:</div><div class="line">            EMU_CK((msv_src == lft_stick) || (msv_src == rgt_stick));</div><div class="line">            <span class="keywordflow">if</span>(msv_src == lft_stick){</div><div class="line">                EMU_CK(left == lft_stick);</div><div class="line">                left = mc_null;</div><div class="line">            }</div><div class="line">            <span class="keywordflow">if</span>(msv_src == rgt_stick){</div><div class="line">                EMU_CK(right == rgt_stick);</div><div class="line">                right = mc_null;</div><div class="line">            }</div><div class="line">            <span class="keywordflow">if</span>((left == mc_null) &amp;&amp; (right == mc_null)){</div><div class="line">                <span class="keywordflow">if</span>(num_bites == MAX_BITES){</div><div class="line">                    PH_DBG(<span class="stringliteral">&quot;I AM FULL \n&quot;</span>);</div><div class="line">                    EMU_LOG(<span class="stringliteral">&quot;I AM FULL \n&quot;</span>);</div><div class="line">                    <a class="code" href="../../d7/d7f/log_8h.html#addbe1979a58d9f84d5a009c5543818c2">mck_sprt2</a>(<span class="stringliteral">&quot;I AM FULL____&quot;</span>);</div><div class="line">                    <a class="code" href="../../d7/d7f/log_8h.html#a2d38dfdcdb36720d61e2ce089b3a1524">mck_iprt</a>(<a class="code" href="../../da/d7a/cell_8hh.html#af1eb47800585646e0caf6cb269111731">mck_get_kernel</a>()-&gt;get_core_nn());</div><div class="line">                    <a class="code" href="../../d7/d7f/log_8h.html#addbe1979a58d9f84d5a009c5543818c2">mck_sprt2</a>(<span class="stringliteral">&quot;___\n&quot;</span>);</div><div class="line"></div><div class="line">                    PH_DBG_COD(<a class="code" href="../../da/db4/shared_8h.html#a93f939625cf4afc446aa8836e1fecae9">mc_set_off_core_var</a>(dbg_all_full[nn], <span class="keyword">true</span>);)</div><div class="line"></div><div class="line">                    send(lft_philo, tok_yes_full);</div><div class="line">                    send(rgt_philo, tok_yes_full);</div><div class="line"></div><div class="line">                    <span class="keywordflow">if</span>(can_exit()){</div><div class="line">                        call_exit();</div><div class="line">                    }</div><div class="line">                } <span class="keywordflow">else</span> {</div><div class="line">                    send(<span class="keyword">this</span>, tok_eat);</div><div class="line">                }</div><div class="line">            }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> tok_yes_full:</div><div class="line">            EMU_CK((msv_src == lft_philo) || (msv_src == rgt_philo));</div><div class="line">            <span class="keywordflow">if</span>(msv_src == lft_philo){ </div><div class="line">                EMU_CK(! lft_ph_full);</div><div class="line">                lft_ph_full = <span class="keyword">true</span>; </div><div class="line">            }</div><div class="line">            <span class="keywordflow">if</span>(msv_src == rgt_philo){ </div><div class="line">                EMU_CK(! rgt_ph_full);</div><div class="line">                rgt_ph_full = <span class="keyword">true</span>; </div><div class="line">            }</div><div class="line">            <span class="keywordflow">if</span>(can_exit()){</div><div class="line">                call_exit();</div><div class="line">            }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">default</span>:</div><div class="line">            <a class="code" href="../../d2/d49/global_8h.html#a6a6d1065bccc17077e1a6a0aeaa5f6dd">mck_abort</a>(1, const_cast&lt;char*&gt;(<span class="stringliteral">&quot;BAD_PHILO_TOK&quot;</span>));</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    } </div><div class="line">    </div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span></div><div class="line">philosopher::call_exit(){</div><div class="line">    PH_DBG_COD(</div><div class="line">        prt_idle();</div><div class="line">        prt_full();</div><div class="line">        prt_all_philo();</div><div class="line">    )</div><div class="line">    EMU_LOG(<span class="stringliteral">&quot;FINISHING \n&quot;</span>);</div><div class="line"></div><div class="line">    <span class="comment">//mck_sprt2(&quot;CALLING_EXIT____&quot;);</span></div><div class="line">    <span class="comment">//mck_iprt(mck_get_kernel()-&gt;get_core_nn());</span></div><div class="line">    <span class="comment">//mck_sprt2(&quot;___\n&quot;);</span></div><div class="line"></div><div class="line">    <a class="code" href="../../da/d7a/cell_8hh.html#af1eb47800585646e0caf6cb269111731">mck_get_kernel</a>()-&gt;set_idle_exit();</div><div class="line">}</div><div class="line"></div><div class="line"><span class="preprocessor">#ifdef PHILO_WITH_DBG</span></div><div class="line">    <span class="keywordtype">void</span> prt_idle(){</div><div class="line">        <span class="keywordtype">char</span> full_str[500];</div><div class="line">        <span class="keywordtype">char</span>* pt = full_str;</div><div class="line">        pt += sprintf(pt, <span class="stringliteral">&quot;ALL_IDLE=[&quot;</span>);</div><div class="line">        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> aa = 0; aa &lt; 16; aa++){</div><div class="line">            <span class="keywordtype">bool</span> idl = dbg_all_idle_prt[aa];</div><div class="line">            <span class="keywordflow">if</span>(idl){</div><div class="line">                pt += sprintf(pt, <span class="stringliteral">&quot;%d,&quot;</span>, aa);</div><div class="line">            }</div><div class="line">        }</div><div class="line">        pt += sprintf(pt, <span class="stringliteral">&quot;]\n&quot;</span>);</div><div class="line">        PH_DBG(<span class="stringliteral">&quot;%s&quot;</span>, full_str);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> prt_full(){</div><div class="line">        <span class="keywordtype">char</span> full_str[500];</div><div class="line">        <span class="keywordtype">char</span>* pt = full_str;</div><div class="line">        pt += sprintf(pt, <span class="stringliteral">&quot;ALL_FULL=[&quot;</span>);</div><div class="line">        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> aa = 0; aa &lt; 16; aa++){</div><div class="line">            <span class="keywordtype">bool</span> fll = dbg_all_full[aa];</div><div class="line">            <span class="keywordflow">if</span>(fll){</div><div class="line">                pt += sprintf(pt, <span class="stringliteral">&quot;%d,&quot;</span>, aa);</div><div class="line">            }</div><div class="line">        }</div><div class="line">        pt += sprintf(pt, <span class="stringliteral">&quot;]\n&quot;</span>);</div><div class="line">        PH_DBG(<span class="stringliteral">&quot;%s&quot;</span>, full_str);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> prt_ph(<span class="keywordtype">int</span> aa, philosopher* ph){</div><div class="line">        <span class="keywordtype">char</span> full_str[500];</div><div class="line">        <span class="keywordtype">char</span>* pt = full_str;</div><div class="line">        <span class="keywordtype">bool</span> is_fll = (ph-&gt;num_bites == MAX_BITES);</div><div class="line">        <span class="keywordtype">bool</span> to_exit = ph-&gt;can_exit();</div><div class="line">        pt += sprintf(pt, <span class="stringliteral">&quot;PHILO (%p) %d=[&quot;</span>, ph, aa);</div><div class="line">        pt += sprintf(pt, <span class="stringliteral">&quot;F%d &quot;</span>, is_fll);</div><div class="line">        pt += sprintf(pt, <span class="stringliteral">&quot;X%d &quot;</span>, to_exit);</div><div class="line">        pt += sprintf(pt, <span class="stringliteral">&quot;L%d &quot;</span>, (ph-&gt;left != mc_null)?(1):(0));</div><div class="line">        pt += sprintf(pt, <span class="stringliteral">&quot;R%d &quot;</span>, (ph-&gt;right != mc_null)?(1):(0));</div><div class="line">        pt += sprintf(pt, <span class="stringliteral">&quot;N%d &quot;</span>, ph-&gt;num_bites);</div><div class="line">        pt += sprintf(pt, <span class="stringliteral">&quot;LF%d &quot;</span>, ph-&gt;lft_ph_full);</div><div class="line">        pt += sprintf(pt, <span class="stringliteral">&quot;RF%d &quot;</span>, ph-&gt;rgt_ph_full);</div><div class="line">        pt += sprintf(pt, <span class="stringliteral">&quot;Lsnt=%s &quot;</span>, tok_to_str(ph-&gt;last_sent_lft));</div><div class="line">        pt += sprintf(pt, <span class="stringliteral">&quot;Lrcv=%s &quot;</span>, tok_to_str(ph-&gt;last_recv_lft));</div><div class="line">        pt += sprintf(pt, <span class="stringliteral">&quot;Rsnt=%s &quot;</span>, tok_to_str(ph-&gt;last_sent_rgt));</div><div class="line">        pt += sprintf(pt, <span class="stringliteral">&quot;Rrcv=%s &quot;</span>, tok_to_str(ph-&gt;last_recv_rgt));</div><div class="line">        pt += sprintf(pt, <span class="stringliteral">&quot;]\n&quot;</span>);</div><div class="line">        PH_DBG(<span class="stringliteral">&quot;%s&quot;</span>, full_str);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> prt_ch(<span class="keywordtype">int</span> aa, <a class="code" href="../../d0/d2d/classchopstick.html">chopstick</a>* ch){</div><div class="line">        <span class="keywordtype">char</span> full_str[500];</div><div class="line">        <span class="keywordtype">char</span>* pt = full_str;</div><div class="line">        pt += sprintf(pt, <span class="stringliteral">&quot;STICK (%p) %d=[&quot;</span>, ch, aa);</div><div class="line">        pt += sprintf(pt, <span class="stringliteral">&quot;lst_sent=%s &quot;</span>, tok_to_str(ch-&gt;last_sent));</div><div class="line">        pt += sprintf(pt, <span class="stringliteral">&quot;lst_recv=%s &quot;</span>, tok_to_str(ch-&gt;last_recv));</div><div class="line">        pt += sprintf(pt, <span class="stringliteral">&quot;lst_src=%p &quot;</span>, ch-&gt;last_src);</div><div class="line">        pt += sprintf(pt, <span class="stringliteral">&quot;]\n&quot;</span>);</div><div class="line">        PH_DBG(full_str);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> prt_pc(<span class="keywordtype">int</span> aa, philo_core* pc){</div><div class="line">        <span class="keywordtype">char</span> full_str[500];</div><div class="line">        <span class="keywordtype">char</span>* pt = full_str;</div><div class="line">        pt += sprintf(pt, <span class="stringliteral">&quot;CORE %d=[&quot;</span>, aa);</div><div class="line">        EMU_CODE(</div><div class="line">            pt += sprintf(pt, <span class="stringliteral">&quot;out_work_sz=%ld &quot;</span>, pc-&gt;out_work_sz);</div><div class="line">            pt += sprintf(pt, <span class="stringliteral">&quot;sent_work_sz=%ld &quot;</span>, pc-&gt;sent_work_sz);</div><div class="line">        )</div><div class="line">        EPH_CODE(</div><div class="line">            pt += sprintf(pt, &quot;out_work_sz=%d &quot;, pc-&gt;out_work_sz);</div><div class="line">            pt += sprintf(pt, &quot;sent_work_sz=%d &quot;, pc-&gt;sent_work_sz);</div><div class="line">        )</div><div class="line">        pt += sprintf(pt, &quot;]\n&quot;);</div><div class="line">        PH_DBG(full_str);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> prt_all_philo(){</div><div class="line">        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> aa = 0; aa &lt; 16; aa++){</div><div class="line">            philo_core* phl = dbg_all_philo[aa];</div><div class="line">            <span class="keywordflow">if</span>(phl != mc_null){</div><div class="line">                prt_ch(aa, &amp;(phl-&gt;stick));</div><div class="line">                prt_ph(aa, &amp;(phl-&gt;philo));</div><div class="line">                prt_pc(aa, phl);</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> ker_func(){</div><div class="line">        <a class="code" href="../../d3/d9f/classkernel.html">kernel</a>* ker = <a class="code" href="../../da/d7a/cell_8hh.html#af1eb47800585646e0caf6cb269111731">mck_get_kernel</a>();</div><div class="line">        mc_core_nn_t nn = ker-&gt;<a class="code" href="../../d3/d9f/classkernel.html#a9bea88d9fe21bf2fb40d7c8a7656c30a">get_core_nn</a>();</div><div class="line">        <span class="keywordflow">if</span>(! ker-&gt;did_work &amp;&amp; ! dbg_all_idle_prt[nn]){</div><div class="line">            <a class="code" href="../../da/db4/shared_8h.html#a93f939625cf4afc446aa8836e1fecae9">mc_set_off_core_var</a>(dbg_all_idle_prt[nn], <span class="keyword">true</span>);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">if</span>(ker-&gt;did_work &amp;&amp; dbg_all_idle_prt[nn]){</div><div class="line">            <a class="code" href="../../da/db4/shared_8h.html#a93f939625cf4afc446aa8836e1fecae9">mc_set_off_core_var</a>(dbg_all_idle_prt[nn], <span class="keyword">false</span>);</div><div class="line">        }</div><div class="line">        philo_core* phl = dbg_all_philo[nn];</div><div class="line"></div><div class="line">        phl-&gt;to_host_work_sz = ker-&gt;to_host_work.calc_size();</div><div class="line">        phl-&gt;in_work_sz = ker-&gt;in_work.calc_size();</div><div class="line">        phl-&gt;local_work_sz = ker-&gt;local_work.calc_size();</div><div class="line">        phl-&gt;out_work_sz = ker-&gt;out_work.calc_size();</div><div class="line">        phl-&gt;sent_work_sz = ker-&gt;sent_work.calc_size();</div><div class="line">        phl-&gt;cls_available_cell_sz = ker-&gt;cls_available_cell.calc_size();</div><div class="line">        phl-&gt;cls_available_missive_sz = ker-&gt;cls_available_missive.calc_size();</div><div class="line">        phl-&gt;cls_available_agent_ref_sz = ker-&gt;cls_available_agent_ref.calc_size();</div><div class="line">        phl-&gt;cls_available_agent_grp_sz = ker-&gt;cls_available_agent_grp.calc_size();</div><div class="line">    }</div><div class="line"><span class="preprocessor">#endif // END_OF_PHILO_WITH_DBG</span></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> mc_cores_main() {</div><div class="line">    <a class="code" href="../../d3/d9f/classkernel.html#a4ba03e734fb64b1215170531599a6754">kernel::init_sys</a>();</div><div class="line">    <a class="code" href="../../d3/d9f/classkernel.html">kernel</a>* ker = <a class="code" href="../../da/d7a/cell_8hh.html#af1eb47800585646e0caf6cb269111731">mck_get_kernel</a>();</div><div class="line">    MC_MARK_USED(ker);</div><div class="line"></div><div class="line">    mc_core_nn_t nn = ker-&gt;<a class="code" href="../../d3/d9f/classkernel.html#a9bea88d9fe21bf2fb40d7c8a7656c30a">get_core_nn</a>();</div><div class="line"></div><div class="line">    PH_DBG_COD(</div><div class="line">        <a class="code" href="../../da/db4/shared_8h.html#a93f939625cf4afc446aa8836e1fecae9">mc_set_off_core_var</a>(dbg_all_idle_prt[nn], <span class="keyword">false</span>);</div><div class="line">        <a class="code" href="../../da/db4/shared_8h.html#a93f939625cf4afc446aa8836e1fecae9">mc_set_off_core_var</a>(dbg_all_full[nn], <span class="keyword">false</span>);</div><div class="line">    )</div><div class="line"></div><div class="line">    philo_core* core_dat = philo_core::acquire_alloc();</div><div class="line">    <span class="keywordflow">if</span>(core_dat == mc_null){</div><div class="line">        <a class="code" href="../../d2/d49/global_8h.html#a6a6d1065bccc17077e1a6a0aeaa5f6dd">mck_abort</a>(1, const_cast&lt;char*&gt;(<span class="stringliteral">&quot;CAN NOT INIT GLB CORE DATA&quot;</span>));</div><div class="line">    }</div><div class="line"></div><div class="line">    ker-&gt;user_data = core_dat;</div><div class="line"></div><div class="line">    PH_DBG_COD(</div><div class="line">        ker-&gt;user_func = ker_func;</div><div class="line">        dbg_all_philo[nn] = core_dat;</div><div class="line">    );</div><div class="line"></div><div class="line">    <a class="code" href="../../d7/d85/philo_8cpp.html#adcc662701c5f055b26a048484d17e2c6">glb_philo</a>-&gt;lft_stk_id = mc_nn_to_id(left_chp_nn(nn));</div><div class="line">    <a class="code" href="../../d7/d85/philo_8cpp.html#adcc662701c5f055b26a048484d17e2c6">glb_philo</a>-&gt;rgt_stk_id = mc_nn_to_id(right_chp_nn(nn));</div><div class="line">    <a class="code" href="../../d7/d85/philo_8cpp.html#adcc662701c5f055b26a048484d17e2c6">glb_philo</a>-&gt;lft_stick = <a class="code" href="../../d7/d85/philo_8cpp.html#a35a8b253ce444013c865600fd0694afa">get_stick</a>(<a class="code" href="../../d7/d85/philo_8cpp.html#adcc662701c5f055b26a048484d17e2c6">glb_philo</a>-&gt;lft_stk_id);</div><div class="line">    <a class="code" href="../../d7/d85/philo_8cpp.html#adcc662701c5f055b26a048484d17e2c6">glb_philo</a>-&gt;rgt_stick = <a class="code" href="../../d7/d85/philo_8cpp.html#a35a8b253ce444013c865600fd0694afa">get_stick</a>(<a class="code" href="../../d7/d85/philo_8cpp.html#adcc662701c5f055b26a048484d17e2c6">glb_philo</a>-&gt;rgt_stk_id);</div><div class="line">    <a class="code" href="../../d7/d85/philo_8cpp.html#adcc662701c5f055b26a048484d17e2c6">glb_philo</a>-&gt;lft_phi_id = mc_nn_to_id(left_phl_nn(nn));</div><div class="line">    <a class="code" href="../../d7/d85/philo_8cpp.html#adcc662701c5f055b26a048484d17e2c6">glb_philo</a>-&gt;rgt_phi_id = mc_nn_to_id(right_phl_nn(nn));</div><div class="line">    <a class="code" href="../../d7/d85/philo_8cpp.html#adcc662701c5f055b26a048484d17e2c6">glb_philo</a>-&gt;lft_philo = <a class="code" href="../../d7/d85/philo_8cpp.html#a0ccca4eb20a8d8be83aeb5822cc2d30c">get_philo</a>(<a class="code" href="../../d7/d85/philo_8cpp.html#adcc662701c5f055b26a048484d17e2c6">glb_philo</a>-&gt;lft_phi_id);</div><div class="line">    <a class="code" href="../../d7/d85/philo_8cpp.html#adcc662701c5f055b26a048484d17e2c6">glb_philo</a>-&gt;rgt_philo = <a class="code" href="../../d7/d85/philo_8cpp.html#a0ccca4eb20a8d8be83aeb5822cc2d30c">get_philo</a>(<a class="code" href="../../d7/d85/philo_8cpp.html#adcc662701c5f055b26a048484d17e2c6">glb_philo</a>-&gt;rgt_phi_id);</div><div class="line"></div><div class="line">    <a class="code" href="../../d3/d9f/classkernel.html#a4af01f01c949a504cd3a6d574eced6a7">kernel::set_handlers</a>(3, the_handlers);</div><div class="line"></div><div class="line">    <a class="code" href="../../d4/d9f/classmissive.html#a9b9925cee46b73d4f9012ab72ce96c4c">missive::separate</a>(mc_out_num_cores);</div><div class="line">    <a class="code" href="../../db/df1/classagent__ref.html#a9cc42d67af5a3cf8ae01bfa6434489be">agent_ref::separate</a>(mc_out_num_cores);</div><div class="line">    <a class="code" href="../../d5/d7b/classagent__grp.html#afa435a806a32ebba3554703581852db3">agent_grp::separate</a>(mc_out_num_cores);</div><div class="line"></div><div class="line">    <a class="code" href="../../d2/dbe/classcell.html#ad09500ef03d2ccb60de17f189ba59b9e">chopstick::separate</a>(1);</div><div class="line">    <a class="code" href="../../d2/dbe/classcell.html#ad09500ef03d2ccb60de17f189ba59b9e">philosopher::separate</a>(1);</div><div class="line"></div><div class="line">    PH_DBG(<span class="stringliteral">&quot;started\n&quot;</span>);</div><div class="line"></div><div class="line">    <a class="code" href="../../d7/d85/philo_8cpp.html#adcc662701c5f055b26a048484d17e2c6">glb_philo</a>-&gt;send(<a class="code" href="../../d7/d85/philo_8cpp.html#adcc662701c5f055b26a048484d17e2c6">glb_philo</a>, tok_eat);</div><div class="line">    <a class="code" href="../../d3/d9f/classkernel.html#a438f0450a28abb54d058b88ef8cc3d3b">kernel::run_sys</a>();</div><div class="line"></div><div class="line">    PH_DBG(<span class="stringliteral">&quot;finished\n&quot;</span>);</div><div class="line">    EMU_LOG(<span class="stringliteral">&quot;PHILOSOPHER %d FINISHED !!\n&quot;</span>, nn);</div><div class="line">    <a class="code" href="../../d7/d7f/log_8h.html#a8ec0c02a2d94dec909d9cdc8340f733f">mck_slog2</a>(<span class="stringliteral">&quot;PHILOSOPHERS FINISHED !!\n&quot;</span>);    </div><div class="line"></div><div class="line">    <a class="code" href="../../d3/d9f/classkernel.html#a55fbe958137c0973a06da58fe491c9e6">kernel::finish_sys</a>();</div><div class="line">}</div><div class="line"></div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Jun 26 2017 18:34:37 for Library-Documentation by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
